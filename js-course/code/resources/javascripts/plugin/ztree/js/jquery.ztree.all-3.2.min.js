
/*
 * JQuery zTree core 3.2
 * http://code.google.com/p/jquerytree/
 *
 * Copyright (c) 2010 Hunter.z (baby666.cn)
 *
 * Licensed same as jquery - MIT License
 * http://www.opensource.org/licenses/mit-license.php
 *
 * email: hunter.z@263.net
 * Date: 2012-05-13
 */
(function($){var settings={},roots={},caches={},zId=0,_consts={event:{NODECREATED:"ztree_nodeCreated",CLICK:"ztree_click",EXPAND:"ztree_expand",COLLAPSE:"ztree_collapse",ASYNC_SUCCESS:"ztree_async_success",ASYNC_ERROR:"ztree_async_error"},id:{A:"_a",ICON:"_ico",SPAN:"_span",SWITCH:"_switch",UL:"_ul"},line:{ROOT:"root",ROOTS:"roots",CENTER:"center",BOTTOM:"bottom",NOLINE:"noline",LINE:"line"},folder:{OPEN:"open",CLOSE:"close",DOCU:"docu"},node:{CURSELECTED:"curSelectedNode"},editor:{MAX_LENGTH:64}},_setting={treeId:"",treeObj:null,view:{addDiyDom:null,autoCancelSelected:true,dblClickExpand:true,expandSpeed:"fast",fontCss:{},nameIsHTML:false,selectedMulti:true,showIcon:true,showLine:true,showTitle:true},data:{key:{children:"children",name:"name",title:"",url:"url"},simpleData:{enable:false,idKey:"id",pIdKey:"pId",rootPId:null},keep:{parent:false,leaf:false}},async:{enable:false,contentType:"application/x-www-form-urlencoded",type:"post",dataType:"text",url:"",autoParam:[],otherParam:[],dataFilter:null},callback:{beforeAsync:null,beforeClick:null,beforeRightClick:null,beforeMouseDown:null,beforeMouseUp:null,beforeExpand:null,beforeCollapse:null,beforeRemove:null,onAsyncError:null,onAsyncSuccess:null,onNodeCreated:null,onClick:null,onRightClick:null,onMouseDown:null,onMouseUp:null,onExpand:null,onCollapse:null,onRemove:null}},_initRoot=function(setting){var r=data.getRoot(setting);if(!r){r={};data.setRoot(setting,r)}r.children=[];r.expandTriggerFlag=false;r.curSelectedList=[];r.noSelection=true;r.createdNodes=[]},_initCache=function(setting){var c=data.getCache(setting);if(!c){c={};data.setCache(setting,c)}c.nodes=[];c.doms=[]},_bindEvent=function(setting){var o=setting.treeObj,c=consts.event;o.unbind(c.NODECREATED);o.bind(c.NODECREATED,function(event,treeId,node){tools.apply(setting.callback.onNodeCreated,[event,treeId,node])});o.unbind(c.CLICK);o.bind(c.CLICK,function(event,srcEvent,treeId,node,clickFlag){tools.apply(setting.callback.onClick,[srcEvent,treeId,node,clickFlag])});o.unbind(c.EXPAND);o.bind(c.EXPAND,function(event,treeId,node){tools.apply(setting.callback.onExpand,[event,treeId,node])});o.unbind(c.COLLAPSE);o.bind(c.COLLAPSE,function(event,treeId,node){tools.apply(setting.callback.onCollapse,[event,treeId,node])});o.unbind(c.ASYNC_SUCCESS);o.bind(c.ASYNC_SUCCESS,function(event,treeId,node,msg){tools.apply(setting.callback.onAsyncSuccess,[event,treeId,node,msg])});o.unbind(c.ASYNC_ERROR);o.bind(c.ASYNC_ERROR,function(event,treeId,node,XMLHttpRequest,textStatus,errorThrown){tools.apply(setting.callback.onAsyncError,[event,treeId,node,XMLHttpRequest,textStatus,errorThrown])})},_eventProxy=function(event){var target=event.target,setting=settings[event.data.treeId],tId="",node=null,nodeEventType="",treeEventType="",nodeEventCallback=null,treeEventCallback=null,tmp=null;if(tools.eqs(event.type,"mousedown")){treeEventType="mousedown"}else{if(tools.eqs(event.type,"mouseup")){treeEventType="mouseup"}else{if(tools.eqs(event.type,"contextmenu")){treeEventType="contextmenu"}else{if(tools.eqs(event.type,"click")){if(tools.eqs(target.tagName,"span")&&target.getAttribute("treeNode"+consts.id.SWITCH)!==null){tId=target.parentNode.id;nodeEventType="switchNode"}else{tmp=tools.getMDom(setting,target,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(tmp){tId=tmp.parentNode.id;nodeEventType="clickNode"}}}else{if(tools.eqs(event.type,"dblclick")){treeEventType="dblclick";tmp=tools.getMDom(setting,target,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(tmp){tId=tmp.parentNode.id;nodeEventType="switchNode"}}}}}}if(treeEventType.length>0&&tId.length==0){tmp=tools.getMDom(setting,target,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(tmp){tId=tmp.parentNode.id}}if(tId.length>0){node=data.getNodeCache(setting,tId);switch(nodeEventType){case"switchNode":if(!node.isParent){nodeEventType=""}else{if(tools.eqs(event.type,"click")||(tools.eqs(event.type,"dblclick")&&tools.apply(setting.view.dblClickExpand,[setting.treeId,node],setting.view.dblClickExpand))){nodeEventCallback=handler.onSwitchNode}else{nodeEventType=""}}break;case"clickNode":nodeEventCallback=handler.onClickNode;break}}switch(treeEventType){case"mousedown":treeEventCallback=handler.onZTreeMousedown;break;case"mouseup":treeEventCallback=handler.onZTreeMouseup;break;case"dblclick":treeEventCallback=handler.onZTreeDblclick;break;case"contextmenu":treeEventCallback=handler.onZTreeContextmenu;break}var proxyResult={stop:false,node:node,nodeEventType:nodeEventType,nodeEventCallback:nodeEventCallback,treeEventType:treeEventType,treeEventCallback:treeEventCallback};return proxyResult},_initNode=function(setting,level,n,parentNode,isFirstNode,isLastNode,openFlag){if(!n){return}var childKey=setting.data.key.children;n.level=level;n.tId=setting.treeId+"_"+(++zId);n.parentTId=parentNode?parentNode.tId:null;if(n[childKey]&&n[childKey].length>0){if(typeof n.open=="string"){n.open=tools.eqs(n.open,"true")}n.open=!!n.open;n.isParent=true;n.zAsync=true}else{n.open=false;if(typeof n.isParent=="string"){n.isParent=tools.eqs(n.isParent,"true")}n.isParent=!!n.isParent;n.zAsync=!n.isParent}n.isFirstNode=isFirstNode;n.isLastNode=isLastNode;n.getParentNode=function(){return data.getNodeCache(setting,n.parentTId)};n.getPreNode=function(){return data.getPreNode(setting,n)};n.getNextNode=function(){return data.getNextNode(setting,n)};n.isAjaxing=false;data.fixPIdKeyValue(setting,n)},_init={bind:[_bindEvent],caches:[_initCache],nodes:[_initNode],proxys:[_eventProxy],roots:[_initRoot],beforeA:[],afterA:[],innerBeforeA:[],innerAfterA:[],zTreeTools:[]},data={addNodeCache:function(setting,node){data.getCache(setting).nodes[node.tId]=node},addAfterA:function(afterA){_init.afterA.push(afterA)},addBeforeA:function(beforeA){_init.beforeA.push(beforeA)},addInnerAfterA:function(innerAfterA){_init.innerAfterA.push(innerAfterA)},addInnerBeforeA:function(innerBeforeA){_init.innerBeforeA.push(innerBeforeA)},addInitBind:function(bindEvent){_init.bind.push(bindEvent)},addInitCache:function(initCache){_init.caches.push(initCache)},addInitNode:function(initNode){_init.nodes.push(initNode)},addInitProxy:function(initProxy){_init.proxys.push(initProxy)},addInitRoot:function(initRoot){_init.roots.push(initRoot)},addNodesData:function(setting,parentNode,nodes){var childKey=setting.data.key.children;if(!parentNode[childKey]){parentNode[childKey]=[]}if(parentNode[childKey].length>0){parentNode[childKey][parentNode[childKey].length-1].isLastNode=false;view.setNodeLineIcos(setting,parentNode[childKey][parentNode[childKey].length-1])}parentNode.isParent=true;parentNode[childKey]=parentNode[childKey].concat(nodes)},addSelectedNode:function(setting,node){var root=data.getRoot(setting);if(!data.isSelectedNode(setting,node)){root.curSelectedList.push(node)}},addCreatedNode:function(setting,node){if(!!setting.callback.onNodeCreated||!!setting.view.addDiyDom){var root=data.getRoot(setting);root.createdNodes.push(node)}},addZTreeTools:function(zTreeTools){_init.zTreeTools.push(zTreeTools)},exSetting:function(s){$.extend(true,_setting,s)},fixPIdKeyValue:function(setting,node){if(setting.data.simpleData.enable){node[setting.data.simpleData.pIdKey]=node.parentTId?node.getParentNode()[setting.data.simpleData.idKey]:setting.data.simpleData.rootPId}},getAfterA:function(setting,node,array){for(var i=0,j=_init.afterA.length;i<j;i++){_init.afterA[i].apply(this,arguments)}},getBeforeA:function(setting,node,array){for(var i=0,j=_init.beforeA.length;i<j;i++){_init.beforeA[i].apply(this,arguments)}},getInnerAfterA:function(setting,node,array){for(var i=0,j=_init.innerAfterA.length;i<j;i++){_init.innerAfterA[i].apply(this,arguments)}},getInnerBeforeA:function(setting,node,array){for(var i=0,j=_init.innerBeforeA.length;i<j;i++){_init.innerBeforeA[i].apply(this,arguments)}},getCache:function(setting){return caches[setting.treeId]},getNextNode:function(setting,node){if(!node){return null}var childKey=setting.data.key.children,p=node.parentTId?node.getParentNode():data.getRoot(setting);if(node.isLastNode){return null}else{if(node.isFirstNode){return p[childKey][1]}else{for(var i=1,l=p[childKey].length-1;i<l;i++){if(p[childKey][i]===node){return p[childKey][i+1]}}}}return null},getNodeByParam:function(setting,nodes,key,value){if(!nodes||!key){return null}var childKey=setting.data.key.children;for(var i=0,l=nodes.length;i<l;i++){if(nodes[i][key]==value){return nodes[i]}var tmp=data.getNodeByParam(setting,nodes[i][childKey],key,value);if(tmp){return tmp}}return null},getNodeCache:function(setting,tId){if(!tId){return null}var n=caches[setting.treeId].nodes[tId];return n?n:null},getNodes:function(setting){return data.getRoot(setting)[setting.data.key.children]},getNodesByParam:function(setting,nodes,key,value){if(!nodes||!key){return[]}var childKey=setting.data.key.children,result=[];for(var i=0,l=nodes.length;i<l;i++){if(nodes[i][key]==value){result.push(nodes[i])}result=result.concat(data.getNodesByParam(setting,nodes[i][childKey],key,value))}return result},getNodesByParamFuzzy:function(setting,nodes,key,value){if(!nodes||!key){return[]}var childKey=setting.data.key.children,result=[];for(var i=0,l=nodes.length;i<l;i++){if(typeof nodes[i][key]=="string"&&nodes[i][key].indexOf(value)>-1){result.push(nodes[i])}result=result.concat(data.getNodesByParamFuzzy(setting,nodes[i][childKey],key,value))}return result},getNodesByFilter:function(setting,nodes,filter,isSingle){if(!nodes){return(isSingle?null:[])}var childKey=setting.data.key.children,result=isSingle?null:[];for(var i=0,l=nodes.length;i<l;i++){if(tools.apply(filter,[nodes[i]],false)){if(isSingle){return nodes[i]}result.push(nodes[i])}var tmpResult=data.getNodesByFilter(setting,nodes[i][childKey],filter,isSingle);if(isSingle&&!!tmpResult){return tmpResult}result=isSingle?tmpResult:result.concat(tmpResult)}return result},getPreNode:function(setting,node){if(!node){return null}var childKey=setting.data.key.children,p=node.parentTId?node.getParentNode():data.getRoot(setting);if(node.isFirstNode){return null}else{if(node.isLastNode){return p[childKey][p[childKey].length-2]}else{for(var i=1,l=p[childKey].length-1;i<l;i++){if(p[childKey][i]===node){return p[childKey][i-1]}}}}return null},getRoot:function(setting){return setting?roots[setting.treeId]:null},getSetting:function(treeId){return settings[treeId]},getSettings:function(){return settings},getTitleKey:function(setting){return setting.data.key.title===""?setting.data.key.name:setting.data.key.title},getZTreeTools:function(treeId){var r=this.getRoot(this.getSetting(treeId));return r?r.treeTools:null},initCache:function(setting){for(var i=0,j=_init.caches.length;i<j;i++){_init.caches[i].apply(this,arguments)}},initNode:function(setting,level,node,parentNode,preNode,nextNode){for(var i=0,j=_init.nodes.length;i<j;i++){_init.nodes[i].apply(this,arguments)}},initRoot:function(setting){for(var i=0,j=_init.roots.length;i<j;i++){_init.roots[i].apply(this,arguments)}},isSelectedNode:function(setting,node){var root=data.getRoot(setting);for(var i=0,j=root.curSelectedList.length;i<j;i++){if(node===root.curSelectedList[i]){return true}}return false},removeNodeCache:function(setting,node){var childKey=setting.data.key.children;if(node[childKey]){for(var i=0,l=node[childKey].length;i<l;i++){arguments.callee(setting,node[childKey][i])}}delete data.getCache(setting).nodes[node.tId]},removeSelectedNode:function(setting,node){var root=data.getRoot(setting);for(var i=0,j=root.curSelectedList.length;i<j;i++){if(node===root.curSelectedList[i]||!data.getNodeCache(setting,root.curSelectedList[i].tId)){root.curSelectedList.splice(i,1);i--;j--}}},setCache:function(setting,cache){caches[setting.treeId]=cache},setRoot:function(setting,root){roots[setting.treeId]=root},setZTreeTools:function(setting,zTreeTools){for(var i=0,j=_init.zTreeTools.length;i<j;i++){_init.zTreeTools[i].apply(this,arguments)}},transformToArrayFormat:function(setting,nodes){if(!nodes){return[]}var childKey=setting.data.key.children,r=[];if(tools.isArray(nodes)){for(var i=0,l=nodes.length;i<l;i++){r.push(nodes[i]);if(nodes[i][childKey]){r=r.concat(data.transformToArrayFormat(setting,nodes[i][childKey]))}}}else{r.push(nodes);if(nodes[childKey]){r=r.concat(data.transformToArrayFormat(setting,nodes[childKey]))}}return r},transformTozTreeFormat:function(setting,sNodes){var i,l,key=setting.data.simpleData.idKey,parentKey=setting.data.simpleData.pIdKey,childKey=setting.data.key.children;if(!key||key==""||!sNodes){return[]}if(tools.isArray(sNodes)){var r=[];var tmpMap=[];for(i=0,l=sNodes.length;i<l;i++){tmpMap[sNodes[i][key]]=sNodes[i]}for(i=0,l=sNodes.length;i<l;i++){if(tmpMap[sNodes[i][parentKey]]&&sNodes[i][key]!=sNodes[i][parentKey]){if(!tmpMap[sNodes[i][parentKey]][childKey]){tmpMap[sNodes[i][parentKey]][childKey]=[]}tmpMap[sNodes[i][parentKey]][childKey].push(sNodes[i])}else{r.push(sNodes[i])}}return r}else{return[sNodes]}}},event={bindEvent:function(setting){for(var i=0,j=_init.bind.length;i<j;i++){_init.bind[i].apply(this,arguments)}},bindTree:function(setting){var eventParam={treeId:setting.treeId},o=setting.treeObj;o.unbind("click",event.proxy);o.bind("click",eventParam,event.proxy);o.unbind("dblclick",event.proxy);o.bind("dblclick",eventParam,event.proxy);o.unbind("mouseover",event.proxy);o.bind("mouseover",eventParam,event.proxy);o.unbind("mouseout",event.proxy);o.bind("mouseout",eventParam,event.proxy);o.unbind("mousedown",event.proxy);o.bind("mousedown",eventParam,event.proxy);o.unbind("mouseup",event.proxy);o.bind("mouseup",eventParam,event.proxy);o.unbind("contextmenu",event.proxy);o.bind("contextmenu",eventParam,event.proxy)},doProxy:function(e){var results=[];for(var i=0,j=_init.proxys.length;i<j;i++){var proxyResult=_init.proxys[i].apply(this,arguments);results.push(proxyResult);if(proxyResult.stop){break}}return results},proxy:function(e){var setting=data.getSetting(e.data.treeId);if(!tools.uCanDo(setting,e)){return true}var results=event.doProxy(e),r=true,x=false;for(var i=0,l=results.length;i<l;i++){var proxyResult=results[i];if(proxyResult.nodeEventCallback){x=true;r=proxyResult.nodeEventCallback.apply(proxyResult,[e,proxyResult.node])&&r}if(proxyResult.treeEventCallback){x=true;r=proxyResult.treeEventCallback.apply(proxyResult,[e,proxyResult.node])&&r}}try{if(x&&$("input:focus").length==0){tools.noSel(setting)}}catch(e){}return r}},handler={onSwitchNode:function(event,node){var setting=settings[event.data.treeId];if(node.open){if(tools.apply(setting.callback.beforeCollapse,[setting.treeId,node],true)==false){return true}data.getRoot(setting).expandTriggerFlag=true;view.switchNode(setting,node)}else{if(tools.apply(setting.callback.beforeExpand,[setting.treeId,node],true)==false){return true}data.getRoot(setting).expandTriggerFlag=true;view.switchNode(setting,node)}return true},onClickNode:function(event,node){var setting=settings[event.data.treeId],clickFlag=((setting.view.autoCancelSelected&&event.ctrlKey)&&data.isSelectedNode(setting,node))?0:(setting.view.autoCancelSelected&&event.ctrlKey&&setting.view.selectedMulti)?2:1;if(tools.apply(setting.callback.beforeClick,[setting.treeId,node,clickFlag],true)==false){return true}if(clickFlag===0){view.cancelPreSelectedNode(setting,node)}else{view.selectNode(setting,node,clickFlag===2)}setting.treeObj.trigger(consts.event.CLICK,[event,setting.treeId,node,clickFlag]);return true},onZTreeMousedown:function(event,node){var setting=settings[event.data.treeId];if(tools.apply(setting.callback.beforeMouseDown,[setting.treeId,node],true)){tools.apply(setting.callback.onMouseDown,[event,setting.treeId,node])}return true},onZTreeMouseup:function(event,node){var setting=settings[event.data.treeId];if(tools.apply(setting.callback.beforeMouseUp,[setting.treeId,node],true)){tools.apply(setting.callback.onMouseUp,[event,setting.treeId,node])}return true},onZTreeDblclick:function(event,node){var setting=settings[event.data.treeId];if(tools.apply(setting.callback.beforeDblClick,[setting.treeId,node],true)){tools.apply(setting.callback.onDblClick,[event,setting.treeId,node])}return true},onZTreeContextmenu:function(event,node){var setting=settings[event.data.treeId];if(tools.apply(setting.callback.beforeRightClick,[setting.treeId,node],true)){tools.apply(setting.callback.onRightClick,[event,setting.treeId,node])}return(typeof setting.callback.onRightClick)!="function"}},tools={apply:function(fun,param,defaultValue){if((typeof fun)=="function"){return fun.apply(zt,param?param:[])}return defaultValue},canAsync:function(setting,node){var childKey=setting.data.key.children;return(setting.async.enable&&node&&node.isParent&&!(node.zAsync||(node[childKey]&&node[childKey].length>0)))},clone:function(jsonObj){var buf;if(jsonObj instanceof Array){buf=[];var i=jsonObj.length;while(i--){buf[i]=arguments.callee(jsonObj[i])}return buf}else{if(typeof jsonObj=="function"){return jsonObj}else{if(jsonObj instanceof Object){buf={};for(var k in jsonObj){buf[k]=arguments.callee(jsonObj[k])}return buf}else{return jsonObj}}}},eqs:function(str1,str2){return str1.toLowerCase()===str2.toLowerCase()},isArray:function(arr){return Object.prototype.toString.apply(arr)==="[object Array]"},getMDom:function(setting,curDom,targetExpr){if(!curDom){return null}while(curDom&&curDom.id!==setting.treeId){for(var i=0,l=targetExpr.length;curDom.tagName&&i<l;i++){if(tools.eqs(curDom.tagName,targetExpr[i].tagName)&&curDom.getAttribute(targetExpr[i].attrName)!==null){return curDom}}curDom=curDom.parentNode}return null},noSel:function(setting){var r=data.getRoot(setting);if(r.noSelection){try{window.getSelection?window.getSelection().removeAllRanges():document.selection.empty()}catch(e){}}},uCanDo:function(setting,e){return true}},view={addNodes:function(setting,parentNode,newNodes,isSilent){if(setting.data.keep.leaf&&parentNode&&!parentNode.isParent){return}if(!tools.isArray(newNodes)){newNodes=[newNodes]}if(setting.data.simpleData.enable){newNodes=data.transformTozTreeFormat(setting,newNodes)}if(parentNode){var target_switchObj=$("#"+parentNode.tId+consts.id.SWITCH),target_icoObj=$("#"+parentNode.tId+consts.id.ICON),target_ulObj=$("#"+parentNode.tId+consts.id.UL);if(!parentNode.open){view.replaceSwitchClass(parentNode,target_switchObj,consts.folder.CLOSE);view.replaceIcoClass(parentNode,target_icoObj,consts.folder.CLOSE);parentNode.open=false;target_ulObj.css({display:"none"})}data.addNodesData(setting,parentNode,newNodes);view.createNodes(setting,parentNode.level+1,newNodes,parentNode);if(!isSilent){view.expandCollapseParentNode(setting,parentNode,true)}}else{data.addNodesData(setting,data.getRoot(setting),newNodes);view.createNodes(setting,0,newNodes,null)}},appendNodes:function(setting,level,nodes,parentNode,initFlag,openFlag){if(!nodes){return[]}var html=[],childKey=setting.data.key.children,nameKey=setting.data.key.name,titleKey=data.getTitleKey(setting);for(var i=0,l=nodes.length;i<l;i++){var node=nodes[i],tmpPNode=(parentNode)?parentNode:data.getRoot(setting),tmpPChild=tmpPNode[childKey],isFirstNode=((tmpPChild.length==nodes.length)&&(i==0)),isLastNode=(i==(nodes.length-1));if(initFlag){data.initNode(setting,level,node,parentNode,isFirstNode,isLastNode,openFlag);data.addNodeCache(setting,node)}var childHtml=[];if(node[childKey]&&node[childKey].length>0){childHtml=view.appendNodes(setting,level+1,node[childKey],node,initFlag,openFlag&&node.open)}if(openFlag){var url=view.makeNodeUrl(setting,node),fontcss=view.makeNodeFontCss(setting,node),fontStyle=[];for(var f in fontcss){fontStyle.push(f,":",fontcss[f],";")}html.push("<li id='",node.tId,"' class='level",node.level,"' tabindex='0' hidefocus='true' treenode>","<span id='",node.tId,consts.id.SWITCH,"' title='' class='",view.makeNodeLineClass(setting,node),"' treeNode",consts.id.SWITCH,"></span>");data.getBeforeA(setting,node,html);html.push("<a id='",node.tId,consts.id.A,"' class='level",node.level,"' treeNode",consts.id.A,' onclick="',(node.click||""),'" ',((url!=null&&url.length>0)?"href='"+url+"'":"")," target='",view.makeNodeTarget(node),"' style='",fontStyle.join(""),"'");if(tools.apply(setting.view.showTitle,[setting.treeId,node],setting.view.showTitle)&&node[titleKey]){html.push("title='",node[titleKey].replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),"'")}html.push(">");data.getInnerBeforeA(setting,node,html);var name=setting.view.nameIsHTML?node[nameKey]:node[nameKey].replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");html.push("<span id='",node.tId,consts.id.ICON,"' title='' treeNode",consts.id.ICON," class='",view.makeNodeIcoClass(setting,node),"' style='",view.makeNodeIcoStyle(setting,node),"'></span><span id='",node.tId,consts.id.SPAN,"'>",name,"</span>");data.getInnerAfterA(setting,node,html);html.push("</a>");data.getAfterA(setting,node,html);if(node.isParent&&node.open){view.makeUlHtml(setting,node,html,childHtml.join(""))}html.push("</li>");data.addCreatedNode(setting,node)}}return html},appendParentULDom:function(setting,node){var html=[],nObj=$("#"+node.tId),ulObj=$("#"+node.tId+consts.id.UL),childKey=setting.data.key.children,childHtml=view.appendNodes(setting,node.level+1,node[childKey],node,false,true);view.makeUlHtml(setting,node,html,childHtml.join(""));if(!nObj.get(0)&&!!node.parentTId){view.appendParentULDom(setting,node.getParentNode());nObj=$("#"+node.tId)}if(ulObj.get(0)){ulObj.remove()}nObj.append(html.join(""));view.createNodeCallback(setting)},asyncNode:function(setting,node,isSilent,callback){var i,l;if(node&&!node.isParent){tools.apply(callback);return false}else{if(node&&node.isAjaxing){return false}else{if(tools.apply(setting.callback.beforeAsync,[setting.treeId,node],true)==false){tools.apply(callback);return false}}}if(node){node.isAjaxing=true;var icoObj=$("#"+node.tId+consts.id.ICON);icoObj.attr({style:"","class":"button ico_loading"})}var isJson=(setting.async.contentType=="application/json"),tmpParam=isJson?"{":"",jTemp="";for(i=0,l=setting.async.autoParam.length;node&&i<l;i++){var pKey=setting.async.autoParam[i].split("="),spKey=pKey;if(pKey.length>1){spKey=pKey[1];pKey=pKey[0]}if(isJson){jTemp=(typeof node[pKey]=="string")?'"':"";tmpParam+='"'+spKey+('":'+jTemp+node[pKey]).replace(/'/g,"\\'")+jTemp+","}else{tmpParam+=spKey+("="+node[pKey]).replace(/&/g,"%26")+"&"}}if(tools.isArray(setting.async.otherParam)){for(i=0,l=setting.async.otherParam.length;i<l;i+=2){if(isJson){jTemp=(typeof setting.async.otherParam[i+1]=="string")?'"':"";tmpParam+='"'+setting.async.otherParam[i]+('":'+jTemp+setting.async.otherParam[i+1]).replace(/'/g,"\\'")+jTemp+","}else{tmpParam+=setting.async.otherParam[i]+("="+setting.async.otherParam[i+1]).replace(/&/g,"%26")+"&"}}}else{for(var p in setting.async.otherParam){if(isJson){jTemp=(typeof setting.async.otherParam[p]=="string")?'"':"";tmpParam+='"'+p+('":'+jTemp+setting.async.otherParam[p]).replace(/'/g,"\\'")+jTemp+","}else{tmpParam+=p+("="+setting.async.otherParam[p]).replace(/&/g,"%26")+"&"}}}if(tmpParam.length>1){tmpParam=tmpParam.substring(0,tmpParam.length-1)}if(isJson){tmpParam+="}"}$.ajax({contentType:setting.async.contentType,type:setting.async.type,url:tools.apply(setting.async.url,[setting.treeId,node],setting.async.url),data:tmpParam,dataType:setting.async.dataType,success:function(msg){var newNodes=[];try{if(!msg||msg.length==0){newNodes=[]}else{if(typeof msg=="string"){newNodes=eval("("+msg+")")}else{newNodes=msg}}}catch(err){}if(node){node.isAjaxing=null;node.zAsync=true}view.setNodeLineIcos(setting,node);if(newNodes&&newNodes!=""){newNodes=tools.apply(setting.async.dataFilter,[setting.treeId,node,newNodes],newNodes);view.addNodes(setting,node,!!newNodes?tools.clone(newNodes):[],!!isSilent)}else{view.addNodes(setting,node,[],!!isSilent)}setting.treeObj.trigger(consts.event.ASYNC_SUCCESS,[setting.treeId,node,msg]);tools.apply(callback)},error:function(XMLHttpRequest,textStatus,errorThrown){if(node){node.isAjaxing=null}view.setNodeLineIcos(setting,node);setting.treeObj.trigger(consts.event.ASYNC_ERROR,[setting.treeId,node,XMLHttpRequest,textStatus,errorThrown])}});return true},cancelPreSelectedNode:function(setting,node){var list=data.getRoot(setting).curSelectedList;for(var i=0,j=list.length-1;j>=i;j--){if(!node||node===list[j]){$("#"+list[j].tId+consts.id.A).removeClass(consts.node.CURSELECTED);view.setNodeName(setting,list[j]);if(node){data.removeSelectedNode(setting,node);break}}}if(!node){data.getRoot(setting).curSelectedList=[]}},createNodeCallback:function(setting){if(!!setting.callback.onNodeCreated||!!setting.view.addDiyDom){var root=data.getRoot(setting);while(root.createdNodes.length>0){var node=root.createdNodes.shift();tools.apply(setting.view.addDiyDom,[setting.treeId,node]);if(!!setting.callback.onNodeCreated){setting.treeObj.trigger(consts.event.NODECREATED,[setting.treeId,node])}}}},createNodes:function(setting,level,nodes,parentNode){if(!nodes||nodes.length==0){return}var root=data.getRoot(setting),childKey=setting.data.key.children,openFlag=!parentNode||parentNode.open||!!$("#"+parentNode[childKey][0].tId).get(0);root.createdNodes=[];var zTreeHtml=view.appendNodes(setting,level,nodes,parentNode,true,openFlag);if(!parentNode){setting.treeObj.append(zTreeHtml.join(""))}else{var ulObj=$("#"+parentNode.tId+consts.id.UL);if(ulObj.get(0)){ulObj.append(zTreeHtml.join(""))}}view.createNodeCallback(setting)},expandCollapseNode:function(setting,node,expandFlag,animateFlag,callback){var root=data.getRoot(setting),childKey=setting.data.key.children;if(!node){tools.apply(callback,[]);return}if(root.expandTriggerFlag){var _callback=callback;callback=function(){if(_callback){_callback()}if(node.open){setting.treeObj.trigger(consts.event.EXPAND,[setting.treeId,node])}else{setting.treeObj.trigger(consts.event.COLLAPSE,[setting.treeId,node])}};root.expandTriggerFlag=false}if(node.open==expandFlag){tools.apply(callback,[]);return}if(!node.open&&node.isParent&&((!$("#"+node.tId+consts.id.UL).get(0))||(node[childKey]&&node[childKey].length>0&&!$("#"+node[childKey][0].tId).get(0)))){view.appendParentULDom(setting,node)}var ulObj=$("#"+node.tId+consts.id.UL),switchObj=$("#"+node.tId+consts.id.SWITCH),icoObj=$("#"+node.tId+consts.id.ICON);if(node.isParent){node.open=!node.open;if(node.iconOpen&&node.iconClose){icoObj.attr("style",view.makeNodeIcoStyle(setting,node))}if(node.open){view.replaceSwitchClass(node,switchObj,consts.folder.OPEN);view.replaceIcoClass(node,icoObj,consts.folder.OPEN);if(animateFlag==false||setting.view.expandSpeed==""){ulObj.show();tools.apply(callback,[])}else{if(node[childKey]&&node[childKey].length>0){ulObj.slideDown(setting.view.expandSpeed,callback)}else{ulObj.show();tools.apply(callback,[])}}}else{view.replaceSwitchClass(node,switchObj,consts.folder.CLOSE);view.replaceIcoClass(node,icoObj,consts.folder.CLOSE);if(animateFlag==false||setting.view.expandSpeed==""||!(node[childKey]&&node[childKey].length>0)){ulObj.hide();tools.apply(callback,[])}else{ulObj.slideUp(setting.view.expandSpeed,callback)}}}else{tools.apply(callback,[])}},expandCollapseParentNode:function(setting,node,expandFlag,animateFlag,callback){if(!node){return}if(!node.parentTId){view.expandCollapseNode(setting,node,expandFlag,animateFlag,callback);return}else{view.expandCollapseNode(setting,node,expandFlag,animateFlag)}if(node.parentTId){view.expandCollapseParentNode(setting,node.getParentNode(),expandFlag,animateFlag,callback)}},expandCollapseSonNode:function(setting,node,expandFlag,animateFlag,callback){var root=data.getRoot(setting),childKey=setting.data.key.children,treeNodes=(node)?node[childKey]:root[childKey],selfAnimateSign=(node)?false:animateFlag,expandTriggerFlag=data.getRoot(setting).expandTriggerFlag;data.getRoot(setting).expandTriggerFlag=false;if(treeNodes){for(var i=0,l=treeNodes.length;i<l;i++){if(treeNodes[i]){view.expandCollapseSonNode(setting,treeNodes[i],expandFlag,selfAnimateSign)}}}data.getRoot(setting).expandTriggerFlag=expandTriggerFlag;view.expandCollapseNode(setting,node,expandFlag,animateFlag,callback)},makeNodeFontCss:function(setting,node){var fontCss=tools.apply(setting.view.fontCss,[setting.treeId,node],setting.view.fontCss);return(fontCss&&((typeof fontCss)!="function"))?fontCss:{}},makeNodeIcoClass:function(setting,node){var icoCss=["ico"];if(!node.isAjaxing){icoCss[0]=(node.iconSkin?node.iconSkin+"_":"")+icoCss[0];if(node.isParent){icoCss.push(node.open?consts.folder.OPEN:consts.folder.CLOSE)}else{icoCss.push(consts.folder.DOCU)}}return"button "+icoCss.join("_")},makeNodeIcoStyle:function(setting,node){var icoStyle=[];if(!node.isAjaxing){var icon=(node.isParent&&node.iconOpen&&node.iconClose)?(node.open?node.iconOpen:node.iconClose):node.icon;if(icon){icoStyle.push("background:url(",icon,") 0 0 no-repeat;")}if(setting.view.showIcon==false||!tools.apply(setting.view.showIcon,[setting.treeId,node],true)){icoStyle.push("width:0px;height:0px;")}}return icoStyle.join("")},makeNodeLineClass:function(setting,node){var lineClass=[];if(setting.view.showLine){if(node.level==0&&node.isFirstNode&&node.isLastNode){lineClass.push(consts.line.ROOT)}else{if(node.level==0&&node.isFirstNode){lineClass.push(consts.line.ROOTS)}else{if(node.isLastNode){lineClass.push(consts.line.BOTTOM)}else{lineClass.push(consts.line.CENTER)}}}}else{lineClass.push(consts.line.NOLINE)}if(node.isParent){lineClass.push(node.open?consts.folder.OPEN:consts.folder.CLOSE)}else{lineClass.push(consts.folder.DOCU)}return view.makeNodeLineClassEx(node)+lineClass.join("_")},makeNodeLineClassEx:function(node){return"button level"+node.level+" switch "},makeNodeTarget:function(node){return(node.target||"_blank")},makeNodeUrl:function(setting,node){var urlKey=setting.data.key.url;return node[urlKey]?node[urlKey]:null},makeUlHtml:function(setting,node,html,content){html.push("<ul id='",node.tId,consts.id.UL,"' class='level",node.level," ",view.makeUlLineClass(setting,node),"' style='display:",(node.open?"block":"none"),"'>");html.push(content);html.push("</ul>")},makeUlLineClass:function(setting,node){return((setting.view.showLine&&!node.isLastNode)?consts.line.LINE:"")},removeChildNodes:function(setting,node){if(!node){return}var childKey=setting.data.key.children,nodes=node[childKey];if(!nodes){return}for(var i=0,l=nodes.length;i<l;i++){data.removeNodeCache(setting,nodes[i])}data.removeSelectedNode(setting);delete node[childKey];if(!setting.data.keep.parent){node.isParent=false;node.open=false;var tmp_switchObj=$("#"+node.tId+consts.id.SWITCH),tmp_icoObj=$("#"+node.tId+consts.id.ICON);view.replaceSwitchClass(node,tmp_switchObj,consts.folder.DOCU);view.replaceIcoClass(node,tmp_icoObj,consts.folder.DOCU);$("#"+node.tId+consts.id.UL).remove()}else{$("#"+node.tId+consts.id.UL).empty()}},removeNode:function(setting,node){var root=data.getRoot(setting),childKey=setting.data.key.children,parentNode=(node.parentTId)?node.getParentNode():root;node.isFirstNode=false;node.isLastNode=false;node.getPreNode=function(){return null};node.getNextNode=function(){return null};$("#"+node.tId).remove();data.removeNodeCache(setting,node);data.removeSelectedNode(setting,node);for(var i=0,l=parentNode[childKey].length;i<l;i++){if(parentNode[childKey][i].tId==node.tId){parentNode[childKey].splice(i,1);break}}var tmp_ulObj,tmp_switchObj,tmp_icoObj;if(!setting.data.keep.parent&&parentNode[childKey].length<1){parentNode.isParent=false;parentNode.open=false;tmp_ulObj=$("#"+parentNode.tId+consts.id.UL);tmp_switchObj=$("#"+parentNode.tId+consts.id.SWITCH);tmp_icoObj=$("#"+parentNode.tId+consts.id.ICON);view.replaceSwitchClass(parentNode,tmp_switchObj,consts.folder.DOCU);view.replaceIcoClass(parentNode,tmp_icoObj,consts.folder.DOCU);tmp_ulObj.css("display","none")}else{if(setting.view.showLine&&parentNode[childKey].length>0){var newLast=parentNode[childKey][parentNode[childKey].length-1];newLast.isLastNode=true;newLast.isFirstNode=(parentNode[childKey].length==1);tmp_ulObj=$("#"+newLast.tId+consts.id.UL);tmp_switchObj=$("#"+newLast.tId+consts.id.SWITCH);tmp_icoObj=$("#"+newLast.tId+consts.id.ICON);if(parentNode==root){if(parentNode[childKey].length==1){view.replaceSwitchClass(newLast,tmp_switchObj,consts.line.ROOT)}else{var tmp_first_switchObj=$("#"+parentNode[childKey][0].tId+consts.id.SWITCH);view.replaceSwitchClass(parentNode[childKey][0],tmp_first_switchObj,consts.line.ROOTS);view.replaceSwitchClass(newLast,tmp_switchObj,consts.line.BOTTOM)}}else{view.replaceSwitchClass(newLast,tmp_switchObj,consts.line.BOTTOM)}tmp_ulObj.removeClass(consts.line.LINE)}}},replaceIcoClass:function(node,obj,newName){if(!obj||node.isAjaxing){return}var tmpName=obj.attr("class");if(tmpName==undefined){return}var tmpList=tmpName.split("_");switch(newName){case consts.folder.OPEN:case consts.folder.CLOSE:case consts.folder.DOCU:tmpList[tmpList.length-1]=newName;break}obj.attr("class",tmpList.join("_"))},replaceSwitchClass:function(node,obj,newName){if(!obj){return}var tmpName=obj.attr("class");if(tmpName==undefined){return}var tmpList=tmpName.split("_");switch(newName){case consts.line.ROOT:case consts.line.ROOTS:case consts.line.CENTER:case consts.line.BOTTOM:case consts.line.NOLINE:tmpList[0]=view.makeNodeLineClassEx(node)+newName;break;case consts.folder.OPEN:case consts.folder.CLOSE:case consts.folder.DOCU:tmpList[1]=newName;break}obj.attr("class",tmpList.join("_"));if(newName!==consts.folder.DOCU){obj.removeAttr("disabled")}else{obj.attr("disabled","disabled")}},selectNode:function(setting,node,addFlag){if(!addFlag){view.cancelPreSelectedNode(setting)}$("#"+node.tId+consts.id.A).addClass(consts.node.CURSELECTED);data.addSelectedNode(setting,node)},setNodeFontCss:function(setting,treeNode){var aObj=$("#"+treeNode.tId+consts.id.A),fontCss=view.makeNodeFontCss(setting,treeNode);if(fontCss){aObj.css(fontCss)}},setNodeLineIcos:function(setting,node){if(!node){return}var switchObj=$("#"+node.tId+consts.id.SWITCH),ulObj=$("#"+node.tId+consts.id.UL),icoObj=$("#"+node.tId+consts.id.ICON),ulLine=view.makeUlLineClass(setting,node);if(ulLine.length==0){ulObj.removeClass(consts.line.LINE)}else{ulObj.addClass(ulLine)}switchObj.attr("class",view.makeNodeLineClass(setting,node));if(node.isParent){switchObj.removeAttr("disabled")}else{switchObj.attr("disabled","disabled")}icoObj.removeAttr("style");icoObj.attr("style",view.makeNodeIcoStyle(setting,node));icoObj.attr("class",view.makeNodeIcoClass(setting,node))},setNodeName:function(setting,node){var nameKey=setting.data.key.name,titleKey=data.getTitleKey(setting),nObj=$("#"+node.tId+consts.id.SPAN);nObj.empty();if(setting.view.nameIsHTML){nObj.html(node[nameKey])}else{nObj.text(node[nameKey])}if(tools.apply(setting.view.showTitle,[setting.treeId,node],setting.view.showTitle)&&node[titleKey]){var aObj=$("#"+node.tId+consts.id.A);aObj.attr("title",node[titleKey])}},setNodeTarget:function(node){var aObj=$("#"+node.tId+consts.id.A);aObj.attr("target",view.makeNodeTarget(node))},setNodeUrl:function(setting,node){var aObj=$("#"+node.tId+consts.id.A),url=view.makeNodeUrl(setting,node);if(url==null||url.length==0){aObj.removeAttr("href")}else{aObj.attr("href",url)}},switchNode:function(setting,node){if(node.open||!tools.canAsync(setting,node)){view.expandCollapseNode(setting,node,!node.open)}else{if(setting.async.enable){if(!view.asyncNode(setting,node)){view.expandCollapseNode(setting,node,!node.open);return}}else{if(node){view.expandCollapseNode(setting,node,!node.open)}}}}};$.fn.zTree={consts:_consts,_z:{tools:tools,view:view,event:event,data:data},getZTreeObj:function(treeId){var o=data.getZTreeTools(treeId);return o?o:null},init:function(obj,zSetting,zNodes){var setting=tools.clone(_setting);$.extend(true,setting,zSetting);setting.treeId=obj.attr("id");setting.treeObj=obj;setting.treeObj.empty();settings[setting.treeId]=setting;if($.browser.msie&&parseInt($.browser.version)<7){setting.view.expandSpeed=""}data.initRoot(setting);var root=data.getRoot(setting),childKey=setting.data.key.children;zNodes=zNodes?tools.clone(tools.isArray(zNodes)?zNodes:[zNodes]):[];if(setting.data.simpleData.enable){root[childKey]=data.transformTozTreeFormat(setting,zNodes)}else{root[childKey]=zNodes}data.initCache(setting);event.bindTree(setting);event.bindEvent(setting);var zTreeTools={setting:setting,addNodes:function(parentNode,newNodes,isSilent){if(!newNodes){return null}if(!parentNode){parentNode=null}if(parentNode&&!parentNode.isParent&&setting.data.keep.leaf){return null}var xNewNodes=tools.clone(tools.isArray(newNodes)?newNodes:[newNodes]);function addCallback(){view.addNodes(setting,parentNode,xNewNodes,(isSilent==true))}if(tools.canAsync(setting,parentNode)){view.asyncNode(setting,parentNode,isSilent,addCallback)}else{addCallback()}return xNewNodes},cancelSelectedNode:function(node){view.cancelPreSelectedNode(this.setting,node)},expandAll:function(expandFlag){expandFlag=!!expandFlag;view.expandCollapseSonNode(this.setting,null,expandFlag,true);return expandFlag},expandNode:function(node,expandFlag,sonSign,focus,callbackFlag){if(!node||!node.isParent){return null}if(expandFlag!==true&&expandFlag!==false){expandFlag=!node.open}callbackFlag=!!callbackFlag;if(callbackFlag&&expandFlag&&(tools.apply(setting.callback.beforeExpand,[setting.treeId,node],true)==false)){return null}else{if(callbackFlag&&!expandFlag&&(tools.apply(setting.callback.beforeCollapse,[setting.treeId,node],true)==false)){return null}}if(expandFlag&&node.parentTId){view.expandCollapseParentNode(this.setting,node.getParentNode(),expandFlag,false)}if(expandFlag===node.open&&!sonSign){return null}data.getRoot(setting).expandTriggerFlag=callbackFlag;if(sonSign){view.expandCollapseSonNode(this.setting,node,expandFlag,true,function(){if(focus!==false){$("#"+node.tId).focus().blur()}})}else{node.open=!expandFlag;view.switchNode(this.setting,node);if(focus!==false){$("#"+node.tId).focus().blur()}}return expandFlag},getNodes:function(){return data.getNodes(this.setting)},getNodeByParam:function(key,value,parentNode){if(!key){return null}return data.getNodeByParam(this.setting,parentNode?parentNode[this.setting.data.key.children]:data.getNodes(this.setting),key,value)},getNodeByTId:function(tId){return data.getNodeCache(this.setting,tId)},getNodesByParam:function(key,value,parentNode){if(!key){return null}return data.getNodesByParam(this.setting,parentNode?parentNode[this.setting.data.key.children]:data.getNodes(this.setting),key,value)},getNodesByParamFuzzy:function(key,value,parentNode){if(!key){return null}return data.getNodesByParamFuzzy(this.setting,parentNode?parentNode[this.setting.data.key.children]:data.getNodes(this.setting),key,value)},getNodesByFilter:function(filter,isSingle,parentNode){isSingle=!!isSingle;if(!filter||(typeof filter!="function")){return(isSingle?null:[])}return data.getNodesByFilter(this.setting,parentNode?parentNode[this.setting.data.key.children]:data.getNodes(this.setting),filter,isSingle)},getNodeIndex:function(node){if(!node){return null}var childKey=setting.data.key.children,parentNode=(node.parentTId)?node.getParentNode():data.getRoot(this.setting);for(var i=0,l=parentNode[childKey].length;i<l;i++){if(parentNode[childKey][i]==node){return i}}return -1},getSelectedNodes:function(){var r=[],list=data.getRoot(this.setting).curSelectedList;for(var i=0,l=list.length;i<l;i++){r.push(list[i])}return r},isSelectedNode:function(node){return data.isSelectedNode(this.setting,node)},reAsyncChildNodes:function(parentNode,reloadType,isSilent){if(!this.setting.async.enable){return}var isRoot=!parentNode;if(isRoot){parentNode=data.getRoot(this.setting)}if(reloadType=="refresh"){parentNode[this.setting.data.key.children]=[];if(isRoot){this.setting.treeObj.empty()}else{var ulObj=$("#"+parentNode.tId+consts.id.UL);ulObj.empty()}}view.asyncNode(this.setting,isRoot?null:parentNode,!!isSilent)},refresh:function(){this.setting.treeObj.empty();var root=data.getRoot(this.setting),nodes=root[this.setting.data.key.children];data.initRoot(this.setting);root[this.setting.data.key.children]=nodes;data.initCache(this.setting);view.createNodes(this.setting,0,root[this.setting.data.key.children])},removeChildNodes:function(node){if(!node){return null}var childKey=setting.data.key.children,nodes=node[childKey];view.removeChildNodes(setting,node);return nodes?nodes:null},removeNode:function(node,callbackFlag){if(!node){return}callbackFlag=!!callbackFlag;if(callbackFlag&&tools.apply(setting.callback.beforeRemove,[setting.treeId,node],true)==false){return}view.removeNode(setting,node);if(callbackFlag){this.setting.treeObj.trigger(consts.event.REMOVE,[setting.treeId,node])}},selectNode:function(node,addFlag){if(!node){return}if(tools.uCanDo(this.setting)){addFlag=setting.view.selectedMulti&&addFlag;if(node.parentTId){view.expandCollapseParentNode(this.setting,node.getParentNode(),true,false,function(){$("#"+node.tId).focus().blur()})}else{$("#"+node.tId).focus().blur()}view.selectNode(this.setting,node,addFlag)}},transformTozTreeNodes:function(simpleNodes){return data.transformTozTreeFormat(this.setting,simpleNodes)},transformToArray:function(nodes){return data.transformToArrayFormat(this.setting,nodes)},updateNode:function(node,checkTypeFlag){if(!node){return}var nObj=$("#"+node.tId);if(nObj.get(0)&&tools.uCanDo(this.setting)){view.setNodeName(this.setting,node);view.setNodeTarget(node);view.setNodeUrl(this.setting,node);view.setNodeLineIcos(this.setting,node);view.setNodeFontCss(this.setting,node)}}};root.treeTools=zTreeTools;data.setZTreeTools(setting,zTreeTools);if(root[childKey]&&root[childKey].length>0){view.createNodes(setting,0,root[childKey])}else{if(setting.async.enable&&setting.async.url&&setting.async.url!==""){view.asyncNode(setting)}}return zTreeTools}};var zt=$.fn.zTree,consts=zt.consts})(jQuery);(function(f){var x={event:{CHECK:"ztree_check"},id:{CHECK:"_check"},checkbox:{STYLE:"checkbox",DEFAULT:"chk",DISABLED:"disable",FALSE:"false",TRUE:"true",FULL:"full",PART:"part",FOCUS:"focus"},radio:{STYLE:"radio",TYPE_ALL:"all",TYPE_LEVEL:"level"}},l={check:{enable:false,autoCheckTrigger:false,chkStyle:x.checkbox.STYLE,nocheckInherit:false,radioType:x.radio.TYPE_LEVEL,chkboxType:{Y:"ps",N:"ps"}},data:{key:{checked:"checked"}},callback:{beforeCheck:null,onCheck:null}},u=function(y){var z=w.getRoot(y);z.radioCheckedList=[]},d=function(y){},m=function(y){var z=y.treeObj,A=p.event;z.unbind(A.CHECK);z.bind(A.CHECK,function(C,D,B){s.apply(y.callback.onCheck,[C,D,B])})},n=function(E){var F=E.target,H=w.getSetting(E.data.treeId),C="",z=null,A="",D="",y=null,B=null;if(s.eqs(E.type,"mouseover")){if(H.check.enable&&s.eqs(F.tagName,"span")&&F.getAttribute("treeNode"+p.id.CHECK)!==null){C=F.parentNode.id;A="mouseoverCheck"}}else{if(s.eqs(E.type,"mouseout")){if(H.check.enable&&s.eqs(F.tagName,"span")&&F.getAttribute("treeNode"+p.id.CHECK)!==null){C=F.parentNode.id;A="mouseoutCheck"}}else{if(s.eqs(E.type,"click")){if(H.check.enable&&s.eqs(F.tagName,"span")&&F.getAttribute("treeNode"+p.id.CHECK)!==null){C=F.parentNode.id;A="checkNode"}}}}if(C.length>0){z=w.getNodeCache(H,C);switch(A){case"checkNode":y=k.onCheckNode;break;case"mouseoverCheck":y=k.onMouseoverCheck;break;case"mouseoutCheck":y=k.onMouseoutCheck;break}}var G={stop:false,node:z,nodeEventType:A,nodeEventCallback:y,treeEventType:D,treeEventCallback:B};return G},t=function(B,F,E,y,D,A,C){if(!E){return}var z=B.data.key.checked;if(typeof E[z]=="string"){E[z]=s.eqs(E[z],"true")}E[z]=!!E[z];E.checkedOld=E[z];E.nocheck=!!E.nocheck||(B.check.nocheckInherit&&y&&!!y.nocheck);E.chkDisabled=!!E.chkDisabled||(y&&!!y.chkDisabled);if(typeof E.halfCheck=="string"){E.halfCheck=s.eqs(E.halfCheck,"true")}E.halfCheck=!!E.halfCheck;E.check_Child_State=-1;E.check_Focus=false;E.getCheckStatus=function(){return w.getCheckStatus(B,E)};if(A){w.makeChkFlag(B,y)}},a=function(A,C,z){var y=A.data.key.checked;if(A.check.enable){w.makeChkFlag(A,C);if(A.check.chkStyle==p.radio.STYLE&&A.check.radioType==p.radio.TYPE_ALL&&C[y]){var B=w.getRoot(A);B.radioCheckedList.push(C)}z.push("<span ID='",C.tId,p.id.CHECK,"' class='",i.makeChkClass(A,C),"' treeNode",p.id.CHECK,(C.nocheck===true?" style='display:none;'":""),"></span>")}},j=function(A,z){z.checkNode=function(F,E,G,D){var B=this.setting.data.key.checked;if(F.chkDisabled===true){return}if(E!==true&&E!==false){E=!F[B]}D=!!D;if(F[B]===E&&!G){return}else{if(D&&s.apply(this.setting.callback.beforeCheck,[this.setting.treeId,F],true)==false){return}}if(s.uCanDo(this.setting)&&this.setting.check.enable&&F.nocheck!==true){F[B]=E;var C=f("#"+F.tId+p.id.CHECK);if(G||this.setting.check.chkStyle===p.radio.STYLE){i.checkNodeRelation(this.setting,F)}i.setChkClass(this.setting,C,F);i.repairParentChkClassWithSelf(this.setting,F);if(D){A.treeObj.trigger(p.event.CHECK,[A.treeId,F])}}};z.checkAllNodes=function(B){i.repairAllChk(this.setting,!!B)};z.getCheckedNodes=function(C){var B=this.setting.data.key.children;C=(C!==false);return w.getTreeCheckedNodes(this.setting,w.getRoot(A)[B],C)};z.getChangeCheckedNodes=function(){var B=this.setting.data.key.children;return w.getTreeChangeCheckedNodes(this.setting,w.getRoot(A)[B])};z.setChkDisabled=function(C,B){B=!!B;i.repairSonChkDisabled(this.setting,C,B);if(!B){i.repairParentChkDisabled(this.setting,C,B)}};var y=z.updateNode;z.updateNode=function(D,E){if(y){y.apply(z,arguments)}if(!D||!this.setting.check.enable){return}var B=f("#"+D.tId);if(B.get(0)&&s.uCanDo(this.setting)){var C=f("#"+D.tId+p.id.CHECK);if(E==true||this.setting.check.chkStyle===p.radio.STYLE){i.checkNodeRelation(this.setting,D)}i.setChkClass(this.setting,C,D);i.repairParentChkClassWithSelf(this.setting,D)}}},o={getRadioCheckedList:function(B){var A=w.getRoot(B).radioCheckedList;for(var z=0,y=A.length;z<y;z++){if(!w.getNodeCache(B,A[z].tId)){A.splice(z,1);z--;y--}}return A},getCheckStatus:function(z,B){if(!z.check.enable||B.nocheck){return null}var y=z.data.key.checked,A={checked:B[y],half:B.halfCheck?B.halfCheck:(z.check.chkStyle==p.radio.STYLE?(B.check_Child_State===2):(B[y]?(B.check_Child_State>-1&&B.check_Child_State<2):(B.check_Child_State>0)))};return A},getTreeCheckedNodes:function(D,A,F,C){if(!A){return[]}var E=D.data.key.children,z=D.data.key.checked;C=!C?[]:C;for(var B=0,y=A.length;B<y;B++){if(A[B].nocheck!==true&&A[B][z]==F){C.push(A[B])}w.getTreeCheckedNodes(D,A[B][E],F,C)}return C},getTreeChangeCheckedNodes:function(D,A,C){if(!A){return[]}var E=D.data.key.children,z=D.data.key.checked;C=!C?[]:C;for(var B=0,y=A.length;B<y;B++){if(A[B].nocheck!==true&&A[B][z]!=A[B].checkedOld){C.push(A[B])}w.getTreeChangeCheckedNodes(D,A[B][E],C)}return C},makeChkFlag:function(H,B){if(!B){return}var A=H.data.key.children,y=H.data.key.checked,D=-1;if(B[A]){var z=false;for(var F=0,C=B[A].length;F<C;F++){var G=B[A][F];var E=-1;if(H.check.chkStyle==p.radio.STYLE){if(G.nocheck===true){E=G.check_Child_State}else{if(G.halfCheck===true){E=2}else{if(G.nocheck!==true&&G[y]){E=2}else{E=G.check_Child_State>0?2:0}}}if(E==2){D=2;break}else{if(E==0){D=0}}}else{if(H.check.chkStyle==p.checkbox.STYLE){if(G.nocheck===true){E=G.check_Child_State}else{if(G.halfCheck===true){E=1}else{if(G.nocheck!==true&&G[y]){E=(G.check_Child_State===-1||G.check_Child_State===2)?2:1}else{E=(G.check_Child_State>0)?1:0}}}if(E===1){D=1;break}else{if(E===2&&z&&E!==D){D=1;break}else{if(D===2&&E>-1&&E<2){D=1;break}else{if(E>-1){D=E}}}}if(!z){z=(G.nocheck!==true)}}}}}B.check_Child_State=D}},g={},k={onCheckNode:function(C,B){if(B.chkDisabled===true){return false}var A=w.getSetting(C.data.treeId),y=A.data.key.checked;if(s.apply(A.callback.beforeCheck,[A.treeId,B],true)==false){return true}B[y]=!B[y];i.checkNodeRelation(A,B);var z=f("#"+B.tId+p.id.CHECK);i.setChkClass(A,z,B);i.repairParentChkClassWithSelf(A,B);A.treeObj.trigger(p.event.CHECK,[A.treeId,B]);return true},onMouseoverCheck:function(B,A){if(A.chkDisabled===true){return false}var z=w.getSetting(B.data.treeId),y=f("#"+A.tId+p.id.CHECK);A.check_Focus=true;i.setChkClass(z,y,A);return true},onMouseoutCheck:function(B,A){if(A.chkDisabled===true){return false}var z=w.getSetting(B.data.treeId),y=f("#"+A.tId+p.id.CHECK);A.check_Focus=false;i.setChkClass(z,y,A);return true}},h={},e={checkNodeRelation:function(H,B){var F,D,C,A=H.data.key.children,z=H.data.key.checked,y=p.radio;if(H.check.chkStyle==y.STYLE){var G=w.getRadioCheckedList(H);if(B[z]){if(H.check.radioType==y.TYPE_ALL){for(D=G.length-1;D>=0;D--){F=G[D];F[z]=false;G.splice(D,1);i.setChkClass(H,f("#"+F.tId+p.id.CHECK),F);if(F.parentTId!=B.parentTId){i.repairParentChkClassWithSelf(H,F)}}G.push(B)}else{var E=(B.parentTId)?B.getParentNode():w.getRoot(H);for(D=0,C=E[A].length;D<C;D++){F=E[A][D];if(F[z]&&F!=B){F[z]=false;i.setChkClass(H,f("#"+F.tId+p.id.CHECK),F)}}}}else{if(H.check.radioType==y.TYPE_ALL){for(D=0,C=G.length;D<C;D++){if(B==G[D]){G.splice(D,1);break}}}}}else{if(B[z]&&(!B[A]||B[A].length==0||H.check.chkboxType.Y.indexOf("s")>-1)){i.setSonNodeCheckBox(H,B,true)}if(!B[z]&&(!B[A]||B[A].length==0||H.check.chkboxType.N.indexOf("s")>-1)){i.setSonNodeCheckBox(H,B,false)}if(B[z]&&H.check.chkboxType.Y.indexOf("p")>-1){i.setParentNodeCheckBox(H,B,true)}if(!B[z]&&H.check.chkboxType.N.indexOf("p")>-1){i.setParentNodeCheckBox(H,B,false)}}},makeChkClass:function(z,C){var y=z.data.key.checked,E=p.checkbox,B=p.radio,D="";if(C.chkDisabled===true){D=E.DISABLED}else{if(C.halfCheck){D=E.PART}else{if(z.check.chkStyle==B.STYLE){D=(C.check_Child_State<1)?E.FULL:E.PART}else{D=C[y]?((C.check_Child_State===2||C.check_Child_State===-1)?E.FULL:E.PART):((C.check_Child_State<1)?E.FULL:E.PART)}}}var A=z.check.chkStyle+"_"+(C[y]?E.TRUE:E.FALSE)+"_"+D;A=(C.check_Focus&&C.chkDisabled!==true)?A+"_"+E.FOCUS:A;return"button "+E.DEFAULT+" "+A},repairAllChk:function(C,F){if(C.check.enable&&C.check.chkStyle===p.checkbox.STYLE){var A=C.data.key.checked,E=C.data.key.children,z=w.getRoot(C);for(var B=0,y=z[E].length;B<y;B++){var D=z[E][B];if(D.nocheck!==true){D[A]=F}i.setSonNodeCheckBox(C,D,F)}}},repairChkClass:function(z,A){if(!A){return}w.makeChkFlag(z,A);var y=f("#"+A.tId+p.id.CHECK);i.setChkClass(z,y,A)},repairParentChkClass:function(z,A){if(!A||!A.parentTId){return}var y=A.getParentNode();i.repairChkClass(z,y);i.repairParentChkClass(z,y)},repairParentChkClassWithSelf:function(y,A){if(!A){return}var z=y.data.key.children;if(A[z]&&A[z].length>0){i.repairParentChkClass(y,A[z][0])}else{i.repairParentChkClass(y,A)}},repairSonChkDisabled:function(C,E,B){if(!E){return}var D=C.data.key.children;if(E.chkDisabled!=B){E.chkDisabled=B;if(E.nocheck!==true){i.repairChkClass(C,E)}}if(E[D]){for(var A=0,z=E[D].length;A<z;A++){var y=E[D][A];i.repairSonChkDisabled(C,y,B)}}},repairParentChkDisabled:function(z,A,y){if(!A){return}if(A.chkDisabled!=y){A.chkDisabled=y;if(A.nocheck!==true){i.repairChkClass(z,A)}}i.repairParentChkDisabled(z,A.getParentNode(),y)},setChkClass:function(y,A,z){if(!A){return}if(z.nocheck===true){A.hide()}else{A.show()}A.removeClass();A.addClass(i.makeChkClass(y,z))},setParentNodeCheckBox:function(I,B,H,E){var A=I.data.key.children,y=I.data.key.checked,F=f("#"+B.tId+p.id.CHECK);if(!E){E=B}w.makeChkFlag(I,B);if(B.nocheck!==true&&B.chkDisabled!==true){B[y]=H;i.setChkClass(I,F,B);if(I.check.autoCheckTrigger&&B!=E&&B.nocheck!==true){I.treeObj.trigger(p.event.CHECK,[I.treeId,B])}}if(B.parentTId){var G=true;if(!H){var z=B.getParentNode()[A];for(var D=0,C=z.length;D<C;D++){if((z[D].nocheck!==true&&z[D][y])||(z[D].nocheck===true&&z[D].check_Child_State>0)){G=false;break}}}if(G){i.setParentNodeCheckBox(I,B.getParentNode(),H,E)}}},setSonNodeCheckBox:function(I,B,H,E){if(!B){return}var A=I.data.key.children,y=I.data.key.checked,F=f("#"+B.tId+p.id.CHECK);if(!E){E=B}var z=false;if(B[A]){for(var D=0,C=B[A].length;D<C&&B.chkDisabled!==true;D++){var G=B[A][D];i.setSonNodeCheckBox(I,G,H,E);if(G.chkDisabled===true){z=true}}}if(B!=w.getRoot(I)&&B.chkDisabled!==true){if(z&&B.nocheck!==true){w.makeChkFlag(I,B)}if(B.nocheck!==true){B[y]=H;if(!z){B.check_Child_State=(B[A]&&B[A].length>0)?(H?2:0):-1}}else{B.check_Child_State=-1}i.setChkClass(I,F,B);if(I.check.autoCheckTrigger&&B!=E&&B.nocheck!==true){I.treeObj.trigger(p.event.CHECK,[I.treeId,B])}}}},r={tools:h,view:e,event:g,data:o};f.extend(true,f.fn.zTree.consts,x);f.extend(true,f.fn.zTree._z,r);var c=f.fn.zTree,s=c._z.tools,p=c.consts,i=c._z.view,w=c._z.data,q=c._z.event;w.exSetting(l);w.addInitBind(m);w.addInitCache(d);w.addInitNode(t);w.addInitProxy(n);w.addInitRoot(u);w.addBeforeA(a);w.addZTreeTools(j);var v=i.createNodes;i.createNodes=function(A,B,z,y){if(v){v.apply(i,arguments)}if(!z){return}i.repairParentChkClassWithSelf(A,y)};var b=i.removeNode;i.removeNode=function(z,A){var y=A.getParentNode();if(b){b.apply(i,arguments)}if(!A||!y){return}i.repairChkClass(z,y);i.repairParentChkClass(z,y)}})(jQuery);(function(f){var z={event:{DRAG:"ztree_drag",DROP:"ztree_drop",REMOVE:"ztree_remove",RENAME:"ztree_rename"},id:{EDIT:"_edit",INPUT:"_input",REMOVE:"_remove"},move:{TYPE_INNER:"inner",TYPE_PREV:"prev",TYPE_NEXT:"next"},node:{CURSELECTED_EDIT:"curSelectedNode_Edit",TMPTARGET_TREE:"tmpTargetzTree",TMPTARGET_NODE:"tmpTargetNode"}},l={edit:{enable:false,editNameSelectAll:false,showRemoveBtn:true,showRenameBtn:true,removeTitle:"remove",renameTitle:"rename",drag:{autoExpandTrigger:false,isCopy:true,isMove:true,prev:true,next:true,inner:true,minMoveSize:5,borderMax:10,borderMin:-5,maxShowNodeNum:5,autoOpenTime:500}},view:{addHoverDom:null,removeHoverDom:null},callback:{beforeDrag:null,beforeDragOpen:null,beforeDrop:null,beforeEditName:null,beforeRename:null,onDrag:null,onDrop:null,onRename:null}},v=function(A){var B=x.getRoot(A);B.curEditNode=null;B.curEditInput=null;B.curHoverNode=null;B.dragFlag=0;B.dragNodeShowBefore=[];B.dragMaskList=new Array();B.showHoverDom=true},c=function(A){},m=function(A){var B=A.treeObj;var C=p.event;B.unbind(C.RENAME);B.bind(C.RENAME,function(D,F,E){t.apply(A.callback.onRename,[D,F,E])});B.unbind(C.REMOVE);B.bind(C.REMOVE,function(D,F,E){t.apply(A.callback.onRemove,[D,F,E])});B.unbind(C.DRAG);B.bind(C.DRAG,function(E,D,G,F){t.apply(A.callback.onDrag,[D,G,F])});B.unbind(C.DROP);B.bind(C.DROP,function(G,F,I,H,J,E,D){t.apply(A.callback.onDrop,[F,I,H,J,E,D])})},n=function(H){var I=H.target,L=x.getSetting(H.data.treeId),J=H.relatedTarget,F="",B=null,C="",G="",A=null,E=null,D=null;if(t.eqs(H.type,"mouseover")){D=t.getMDom(L,I,[{tagName:"a",attrName:"treeNode"+p.id.A}]);if(D){F=D.parentNode.id;C="hoverOverNode"}}else{if(t.eqs(H.type,"mouseout")){D=t.getMDom(L,J,[{tagName:"a",attrName:"treeNode"+p.id.A}]);if(!D){F="remove";C="hoverOutNode"}}else{if(t.eqs(H.type,"mousedown")){D=t.getMDom(L,I,[{tagName:"a",attrName:"treeNode"+p.id.A}]);if(D){F=D.parentNode.id;C="mousedownNode"}}}}if(F.length>0){B=x.getNodeCache(L,F);switch(C){case"mousedownNode":A=k.onMousedownNode;break;case"hoverOverNode":A=k.onHoverOverNode;break;case"hoverOutNode":A=k.onHoverOutNode;break}}var K={stop:false,node:B,nodeEventType:C,nodeEventCallback:A,treeEventType:G,treeEventCallback:E};return K},u=function(C,G,F,A,E,B,D){if(!F){return}F.isHover=false;F.editNameFlag=false},j=function(B,A){A.cancelEditName=function(D){var C=x.getRoot(B),E=B.data.key.name,F=C.curEditNode;if(!C.curEditNode){return}i.cancelCurEditNode(B,D?D:F[E])};A.copyNode=function(G,F,E,H){if(!F){return null}if(G&&!G.isParent&&B.data.keep.leaf&&E===p.move.TYPE_INNER){return null}var C=t.clone(F);if(!G){G=null;E=p.move.TYPE_INNER}if(E==p.move.TYPE_INNER){function D(){i.addNodes(B,G,[C],H)}if(t.canAsync(B,G)){i.asyncNode(B,G,H,D)}else{D()}}else{i.addNodes(B,G.parentNode,[C],H);i.moveNode(B,G,C,E,false,H)}return C};A.editName=function(C){if(!C||!C.tId||C!==x.getNodeCache(B,C.tId)){return}if(C.parentTId){i.expandCollapseParentNode(B,C.getParentNode(),true)}i.editNode(B,C)};A.moveNode=function(E,D,C,G){if(!D){return D}if(E&&!E.isParent&&B.data.keep.leaf&&C===p.move.TYPE_INNER){return null}else{if(E&&((D.parentTId==E.tId&&C==p.move.TYPE_INNER)||f("#"+D.tId).find("#"+E.tId).length>0)){return null}else{if(!E){E=null}}}function F(){i.moveNode(B,E,D,C,false,G)}if(t.canAsync(B,E)){i.asyncNode(B,E,G,F)}else{F()}return D};A.setEditable=function(C){B.edit.enable=C;return this.refresh()}},o={setSonNodeLevel:function(D,A,F){if(!F){return}var E=D.data.key.children;F.level=(A)?A.level+1:0;if(!F[E]){return}for(var C=0,B=F[E].length;C<B;C++){if(F[E][C]){x.setSonNodeLevel(D,F,F[E][C])}}}},g={},k={onHoverOverNode:function(D,C){var B=x.getSetting(D.data.treeId),A=x.getRoot(B);if(A.curHoverNode!=C){k.onHoverOutNode(D)}A.curHoverNode=C;i.addHoverDom(B,C)},onHoverOutNode:function(D,C){var B=x.getSetting(D.data.treeId),A=x.getRoot(B);if(A.curHoverNode&&!x.isSelectedNode(B,A.curHoverNode)){i.removeTreeDom(B,A.curHoverNode);A.curHoverNode=null}},onMousedownNode:function(M,G){var U,R,L=x.getSetting(M.data.treeId),Q=x.getRoot(L);if(M.button==2||!L.edit.enable||(!L.edit.drag.isCopy&&!L.edit.drag.isMove)){return true}var X=M.target,F=x.getRoot(L).curSelectedList,N=[];if(!x.isSelectedNode(L,G)){N=[G]}else{for(U=0,R=F.length;U<R;U++){if(F[U].editNameFlag&&t.eqs(X.tagName,"input")&&X.getAttribute("treeNode"+p.id.INPUT)!==null){return true}N.push(F[U]);if(N[0].parentTId!==F[U].parentTId){N=[G];break}}}i.editNodeBlur=true;i.cancelCurEditNode(L,null,true);var aa=f(document),T,H,V,W=false,Y=L,A,E,O=null,D=null,K=null,B=p.move.TYPE_INNER,S=M.clientX,P=M.clientY,I=(new Date()).getTime();if(t.uCanDo(L)){aa.bind("mousemove",J)}function J(aZ){if(Q.dragFlag==0&&Math.abs(S-aZ.clientX)<L.edit.drag.minMoveSize&&Math.abs(P-aZ.clientY)<L.edit.drag.minMoveSize){return true}var aU,aQ,ar,aL,aD,aK=L.data.key.children;t.noSel(L);f("body").css("cursor","pointer");if(Q.dragFlag==0){if(t.apply(L.callback.beforeDrag,[L.treeId,N],true)==false){Z(aZ);return true}for(aU=0,aQ=N.length;aU<aQ;aU++){if(aU==0){Q.dragNodeShowBefore=[]}ar=N[aU];if(ar.isParent&&ar.open){i.expandCollapseNode(L,ar,!ar.open);Q.dragNodeShowBefore[ar.tId]=true}else{Q.dragNodeShowBefore[ar.tId]=false}}Q.dragFlag=1;Q.showHoverDom=false;t.showIfameMask(L,true);var ac=true,af=-1;if(N.length>1){var ap=N[0].parentTId?N[0].getParentNode()[aK]:x.getNodes(L);aD=[];for(aU=0,aQ=ap.length;aU<aQ;aU++){if(Q.dragNodeShowBefore[ap[aU].tId]!==undefined){if(ac&&af>-1&&(af+1)!==aU){ac=false}aD.push(ap[aU]);af=aU}if(N.length===aD.length){N=aD;break}}}if(ac){A=N[0].getPreNode();E=N[N.length-1].getNextNode()}T=f("<ul class='zTreeDragUL'></ul>");for(aU=0,aQ=N.length;aU<aQ;aU++){ar=N[aU];ar.editNameFlag=false;i.selectNode(L,ar,aU>0);i.removeTreeDom(L,ar);aL=f("<li id='"+ar.tId+"_tmp'></li>");aL.append(f("#"+ar.tId+p.id.A).clone());aL.css("padding","0");aL.children("#"+ar.tId+p.id.A).removeClass(p.node.CURSELECTED);T.append(aL);if(aU==L.edit.drag.maxShowNodeNum-1){aL=f("<li id='"+ar.tId+"_moretmp'><a>  ...  </a></li>");T.append(aL);break}}T.attr("id",N[0].tId+p.id.UL+"_tmp");T.addClass(L.treeObj.attr("class"));T.appendTo("body");H=f("<span class='tmpzTreeMove_arrow'></span>");H.attr("id","zTreeMove_arrow_tmp");H.appendTo("body");L.treeObj.trigger(p.event.DRAG,[aZ,L.treeId,N])}if(Q.dragFlag==1){if(V&&H.attr("id")==aZ.target.id&&K&&(aZ.clientX+aa.scrollLeft()+2)>(f("#"+K+p.id.A,V).offset().left)){var aY=f("#"+K+p.id.A,V);aZ.target=(aY.length>0)?aY.get(0):aZ.target}else{if(V){V.removeClass(p.node.TMPTARGET_TREE);if(K){f("#"+K+p.id.A,V).removeClass(p.node.TMPTARGET_NODE+"_"+p.move.TYPE_PREV).removeClass(p.node.TMPTARGET_NODE+"_"+z.move.TYPE_NEXT).removeClass(p.node.TMPTARGET_NODE+"_"+z.move.TYPE_INNER)}}}V=null;K=null;W=false;Y=L;var aV=x.getSettings();for(var aM in aV){if(aV[aM].treeId&&aV[aM].edit.enable&&aV[aM].treeId!=L.treeId&&(aZ.target.id==aV[aM].treeId||f(aZ.target).parents("#"+aV[aM].treeId).length>0)){W=true;Y=aV[aM]}}var ao=aa.scrollTop(),aX=aa.scrollLeft(),ad=Y.treeObj.offset(),ax=Y.treeObj.get(0).scrollHeight,aN=Y.treeObj.get(0).scrollWidth,aW=(aZ.clientY+ao-ad.top),aJ=(Y.treeObj.height()+ad.top-aZ.clientY-ao),aE=(aZ.clientX+aX-ad.left),an=(Y.treeObj.width()+ad.left-aZ.clientX-aX),aq=(aW<L.edit.drag.borderMax&&aW>L.edit.drag.borderMin),a0=(aJ<L.edit.drag.borderMax&&aJ>L.edit.drag.borderMin),aH=(aE<L.edit.drag.borderMax&&aE>L.edit.drag.borderMin),al=(an<L.edit.drag.borderMax&&an>L.edit.drag.borderMin),ae=aW>L.edit.drag.borderMin&&aJ>L.edit.drag.borderMin&&aE>L.edit.drag.borderMin&&an>L.edit.drag.borderMin,aB=(aq&&Y.treeObj.scrollTop()<=0),aA=(a0&&(Y.treeObj.scrollTop()+Y.treeObj.height()+10)>=ax),ah=(aH&&Y.treeObj.scrollLeft()<=0),av=(al&&(Y.treeObj.scrollLeft()+Y.treeObj.width()+10)>=aN);if(aZ.target.id&&Y.treeObj.find("#"+aZ.target.id).length>0){var am=aZ.target;while(am&&am.tagName&&!t.eqs(am.tagName,"li")&&am.id!=Y.treeId){am=am.parentNode}var au=true;for(aU=0,aQ=N.length;aU<aQ;aU++){ar=N[aU];if(am.id===ar.tId){au=false;break}else{if(f("#"+ar.tId).find("#"+am.id).length>0){au=false;break}}}if(au){if(aZ.target.id&&(aZ.target.id==(am.id+p.id.A)||f(aZ.target).parents("#"+am.id+p.id.A).length>0)){V=f(am);K=am.id}}}ar=N[0];if(ae&&(aZ.target.id==Y.treeId||f(aZ.target).parents("#"+Y.treeId).length>0)){if(!V&&(aZ.target.id==Y.treeId||aB||aA||ah||av)&&(W||(!W&&ar.parentTId))){V=Y.treeObj}if(aq){Y.treeObj.scrollTop(Y.treeObj.scrollTop()-10)}else{if(a0){Y.treeObj.scrollTop(Y.treeObj.scrollTop()+10)}}if(aH){Y.treeObj.scrollLeft(Y.treeObj.scrollLeft()-10)}else{if(al){Y.treeObj.scrollLeft(Y.treeObj.scrollLeft()+10)}}if(V&&V!=Y.treeObj&&V.offset().left<Y.treeObj.offset().left){Y.treeObj.scrollLeft(Y.treeObj.scrollLeft()+V.offset().left-Y.treeObj.offset().left)}}T.css({top:(aZ.clientY+ao+3)+"px",left:(aZ.clientX+aX+3)+"px"});var az=0;var ay=0;if(V&&V.attr("id")!=Y.treeId){var aI=K==null?null:x.getNodeCache(Y,K),aC=(aZ.ctrlKey&&L.edit.drag.isMove&&L.edit.drag.isCopy)||(!L.edit.drag.isMove&&L.edit.drag.isCopy),aj=!!(A&&K===A.tId),aG=!!(E&&K===E.tId),aS=(ar.parentTId&&ar.parentTId==K),aF=(aC||!aG)&&t.apply(Y.edit.drag.prev,[Y.treeId,N,aI],!!Y.edit.drag.prev),ai=(aC||!aj)&&t.apply(Y.edit.drag.next,[Y.treeId,N,aI],!!Y.edit.drag.next),ab=(aC||!aS)&&!(Y.data.keep.leaf&&!aI.isParent)&&t.apply(Y.edit.drag.inner,[Y.treeId,N,aI],!!Y.edit.drag.inner);if(!aF&&!ai&&!ab){V=null;K="";B=p.move.TYPE_INNER;H.css({display:"none"});if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}}else{var aw=f("#"+K+p.id.A,V),aP=aI.isLastNode?null:f("#"+aI.getNextNode().tId+p.id.A,V.next()),aR=aw.offset().top,aT=aw.offset().left,aO=aF?(ab?0.25:(ai?0.5:1)):-1,ak=ai?(ab?0.75:(aF?0.5:0)):-1,ag=(aZ.clientY+ao-aR)/aw.height();if((aO==1||ag<=aO&&ag>=-0.2)&&aF){az=1-H.width();ay=aR-H.height()/2;B=p.move.TYPE_PREV}else{if((ak==0||ag>=ak&&ag<=1.2)&&ai){az=1-H.width();ay=(aP==null||(aI.isParent&&aI.open))?(aR+aw.height()-H.height()/2):(aP.offset().top-H.height()/2);B=p.move.TYPE_NEXT}else{az=5-H.width();ay=aR;B=p.move.TYPE_INNER}}H.css({display:"block",top:ay+"px",left:(aT+az)+"px"});aw.addClass(p.node.TMPTARGET_NODE+"_"+B);if(O!=K||D!=B){I=(new Date()).getTime()}if(aI&&aI.isParent&&B==p.move.TYPE_INNER){var at=true;if(window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId!==aI.tId){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}else{if(window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId===aI.tId){at=false}}if(at){window.zTreeMoveTimer=setTimeout(function(){if(B!=p.move.TYPE_INNER){return}if(aI&&aI.isParent&&!aI.open&&(new Date()).getTime()-I>Y.edit.drag.autoOpenTime&&t.apply(Y.callback.beforeDragOpen,[Y.treeId,aI],true)){i.switchNode(Y,aI);if(Y.edit.drag.autoExpandTrigger){Y.treeObj.trigger(p.event.EXPAND,[Y.treeId,aI])}}},Y.edit.drag.autoOpenTime+50);window.zTreeMoveTargetNodeTId=aI.tId}}}}else{B=p.move.TYPE_INNER;if(V&&t.apply(Y.edit.drag.inner,[Y.treeId,N,null],!!Y.edit.drag.inner)){V.addClass(p.node.TMPTARGET_TREE)}else{V=null}H.css({display:"none"});if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}}O=K;D=B}return false}aa.bind("mouseup",Z);function Z(ai){if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}O=null;D=null;aa.unbind("mousemove",J);aa.unbind("mouseup",Z);aa.unbind("selectstart",C);f("body").css("cursor","auto");if(V){V.removeClass(p.node.TMPTARGET_TREE);if(K){f("#"+K+p.id.A,V).removeClass(p.node.TMPTARGET_NODE+"_"+p.move.TYPE_PREV).removeClass(p.node.TMPTARGET_NODE+"_"+z.move.TYPE_NEXT).removeClass(p.node.TMPTARGET_NODE+"_"+z.move.TYPE_INNER)}}t.showIfameMask(L,false);Q.showHoverDom=true;if(Q.dragFlag==0){return}Q.dragFlag=0;var ag,ac,ah;for(ag=0,ac=N.length;ag<ac;ag++){ah=N[ag];if(ah.isParent&&Q.dragNodeShowBefore[ah.tId]&&!ah.open){i.expandCollapseNode(L,ah,!ah.open);delete Q.dragNodeShowBefore[ah.tId]}}if(T){T.remove()}if(H){H.remove()}var ab=(ai.ctrlKey&&L.edit.drag.isMove&&L.edit.drag.isCopy)||(!L.edit.drag.isMove&&L.edit.drag.isCopy);if(!ab&&V&&K&&N[0].parentTId&&K==N[0].parentTId&&B==p.move.TYPE_INNER){V=null}if(V){var ad=K==null?null:x.getNodeCache(Y,K);if(t.apply(L.callback.beforeDrop,[Y.treeId,N,ad,B,ab],true)==false){return}var ae=ab?t.clone(N):N;function af(){if(W){if(!ab){for(var ak=0,aj=N.length;ak<aj;ak++){i.removeNode(L,N[ak])}}if(B==p.move.TYPE_INNER){i.addNodes(Y,ad,ae)}else{i.addNodes(Y,ad.getParentNode(),ae);if(B==p.move.TYPE_PREV){for(ak=0,aj=ae.length;ak<aj;ak++){i.moveNode(Y,ad,ae[ak],B,false)}}else{for(ak=-1,aj=ae.length-1;ak<aj;aj--){i.moveNode(Y,ad,ae[aj],B,false)}}}}else{if(ab&&B==p.move.TYPE_INNER){i.addNodes(Y,ad,ae)}else{if(ab){i.addNodes(Y,ad.getParentNode(),ae)}if(B==p.move.TYPE_PREV){for(ak=0,aj=ae.length;ak<aj;ak++){i.moveNode(Y,ad,ae[ak],B,false)}}else{for(ak=-1,aj=ae.length-1;ak<aj;aj--){i.moveNode(Y,ad,ae[aj],B,false)}}}}for(ak=0,aj=ae.length;ak<aj;ak++){i.selectNode(Y,ae[ak],ak>0)}f("#"+ae[0].tId).focus().blur()}if(B==p.move.TYPE_INNER&&t.canAsync(Y,ad)){i.asyncNode(Y,ad,false,af)}else{af()}L.treeObj.trigger(p.event.DROP,[ai,Y.treeId,ae,ad,B,ab])}else{for(ag=0,ac=N.length;ag<ac;ag++){i.selectNode(Y,N[ag],ag>0)}L.treeObj.trigger(p.event.DROP,[ai,L.treeId,N,null,null,null])}}aa.bind("selectstart",C);function C(){return false}if(M.preventDefault){M.preventDefault()}return true}},h={getAbs:function(A){var B=A.getBoundingClientRect();return[B.left,B.top]},inputFocus:function(A){if(A.get(0)){A.focus();t.setCursorPosition(A.get(0),A.val().length)}},inputSelect:function(A){if(A.get(0)){A.focus();A.select()}},setCursorPosition:function(B,C){if(B.setSelectionRange){B.focus();B.setSelectionRange(C,C)}else{if(B.createTextRange){var A=B.createTextRange();A.collapse(true);A.moveEnd("character",C);A.moveStart("character",C);A.select()}}},showIfameMask:function(H,F){var E=x.getRoot(H);while(E.dragMaskList.length>0){E.dragMaskList[0].remove();E.dragMaskList.shift()}if(F){var I=f("iframe");for(var D=0,B=I.length;D<B;D++){var C=I.get(D),A=t.getAbs(C),G=f("<div id='zTreeMask_"+D+"' class='zTreeMask' style='background-color:yellow;opacity: 0.3;filter: alpha(opacity=30);    top:"+A[1]+"px; left:"+A[0]+"px; width:"+C.offsetWidth+"px; height:"+C.offsetHeight+"px;'></div>");G.appendTo("body");E.dragMaskList.push(G)}}}},d={addEditBtn:function(B,C){if(C.editNameFlag||f("#"+C.tId+p.id.EDIT).length>0){return}if(!t.apply(B.edit.showRenameBtn,[B.treeId,C],B.edit.showRenameBtn)){return}var D=f("#"+C.tId+p.id.A),A="<span class='button edit' id='"+C.tId+p.id.EDIT+"' title='"+t.apply(B.edit.renameTitle,[B.treeId,C],B.edit.renameTitle)+"' treeNode"+p.id.EDIT+" style='display:none;'></span>";D.append(A);f("#"+C.tId+p.id.EDIT).bind("click",function(){if(!t.uCanDo(B)||t.apply(B.callback.beforeEditName,[B.treeId,C],true)==false){return false}i.editNode(B,C);return false}).show()},addRemoveBtn:function(A,B){if(B.editNameFlag||f("#"+B.tId+p.id.REMOVE).length>0){return}if(!t.apply(A.edit.showRemoveBtn,[A.treeId,B],A.edit.showRemoveBtn)){return}var D=f("#"+B.tId+p.id.A),C="<span class='button remove' id='"+B.tId+p.id.REMOVE+"' title='"+t.apply(A.edit.removeTitle,[A.treeId,B],A.edit.removeTitle)+"' treeNode"+p.id.REMOVE+" style='display:none;'></span>";D.append(C);f("#"+B.tId+p.id.REMOVE).bind("click",function(){if(!t.uCanDo(A)||t.apply(A.callback.beforeRemove,[A.treeId,B],true)==false){return false}i.removeNode(A,B);A.treeObj.trigger(p.event.REMOVE,[A.treeId,B]);return false}).bind("mousedown",function(E){return true}).show()},addHoverDom:function(A,B){if(x.getRoot(A).showHoverDom){B.isHover=true;if(A.edit.enable){i.addEditBtn(A,B);i.addRemoveBtn(A,B)}t.apply(A.view.addHoverDom,[A.treeId,B])}},cancelCurEditNode:function(H,I){var G=x.getRoot(H),D=H.data.key.name,B=G.curEditNode;if(B){var C=G.curEditInput;var E=I?I:C.val();if(!I&&t.apply(H.callback.beforeRename,[H.treeId,B,E],true)===false){B.editNameFlag=true;return false}else{B[D]=E?E:C.val();if(!I){H.treeObj.trigger(p.event.RENAME,[H.treeId,B])}}var A=f("#"+B.tId+p.id.A);A.removeClass(p.node.CURSELECTED_EDIT);C.unbind();i.setNodeName(H,B);B.editNameFlag=false;G.curEditNode=null;G.curEditInput=null;i.selectNode(H,B,false);var F=f.fn.zTree.getZTreeObj(H.treeId);if(F.addFlag===true){F.removeNode(B);F.addFlag=false}}G.noSelection=true;t.apply(H.callback.afterCancel,[H.treeId,B],true);return true},editNode:function(D,E){var A=x.getRoot(D);i.editNodeBlur=false;if(x.isSelectedNode(D,E)&&A.curEditNode==E&&E.editNameFlag){setTimeout(function(){t.inputFocus(A.curEditInput)},0);return}var C=D.data.key.name;E.editNameFlag=true;i.removeTreeDom(D,E);i.cancelCurEditNode(D);i.selectNode(D,E,false);f("#"+E.tId+p.id.SPAN).html("<input type=text class='rename' id='"+E.tId+p.id.INPUT+"' treeNode"+p.id.INPUT+" >");var B=f("#"+E.tId+p.id.INPUT);B.attr({value:E[C],maxlength:p.editor.MAX_LENGTH});if(D.edit.editNameSelectAll){t.inputSelect(B)}else{t.inputFocus(B)}B.bind("blur",function(F){if(!i.editNodeBlur){i.cancelCurEditNode(D)}}).bind("click",function(F){return false}).bind("dblclick",function(F){return false}).bind("keydown",function(F){if(F.keyCode=="13"){i.editNodeBlur=true;i.cancelCurEditNode(D,null,true)}else{if(F.keyCode=="27"){i.cancelCurEditNode(D,E[C])}}});f("#"+E.tId+p.id.A).addClass(p.node.CURSELECTED_EDIT);A.curEditInput=B;A.noSelection=false;A.curEditNode=E},moveNode:function(K,D,N,C,Y,E){var P=x.getRoot(K),I=K.data.key.children;if(D==N){return}if(K.data.keep.leaf&&D&&!D.isParent&&C==p.move.TYPE_INNER){return}var S=(N.parentTId?N.getParentNode():P),M=(D===null||D==P);if(M&&D===null){D=P}if(M){C=p.move.TYPE_INNER}var A=(D.parentTId?D.getParentNode():P);if(C!=p.move.TYPE_PREV&&C!=p.move.TYPE_NEXT){C=p.move.TYPE_INNER}if(C==p.move.TYPE_INNER){if(M){N.parentTId=null}else{if(!D.isParent){D.isParent=true;D.open=!!D.open;i.setNodeLineIcos(K,D)}N.parentTId=D.tId}}var F,H;if(M){F=K.treeObj;H=F}else{if(!E&&C==p.move.TYPE_INNER){i.expandCollapseNode(K,D,true,false)}else{if(!E){i.expandCollapseNode(K,D.getParentNode(),true,false)}}F=f("#"+D.tId);H=f("#"+D.tId+p.id.UL);if(!H.get(0)){var W=[];i.makeUlHtml(K,D,W,"");F.append(W.join(""))}H=f("#"+D.tId+p.id.UL)}var U=f("#"+N.tId);if(H.get(0)&&C==p.move.TYPE_INNER){H.append(U)}else{if(F.get(0)&&C==p.move.TYPE_PREV){F.before(U)}else{if(F.get(0)&&C==p.move.TYPE_NEXT){F.after(U)}}}var R,Q,G=-1,T=0,X=null,B=null,V=N.level;if(N.isFirstNode){G=0;if(S[I].length>1){X=S[I][1];X.isFirstNode=true}}else{if(N.isLastNode){G=S[I].length-1;X=S[I][G-1];X.isLastNode=true}else{for(R=0,Q=S[I].length;R<Q;R++){if(S[I][R].tId==N.tId){G=R;break}}}}if(G>=0){S[I].splice(G,1)}if(C!=p.move.TYPE_INNER){for(R=0,Q=A[I].length;R<Q;R++){if(A[I][R].tId==D.tId){T=R}}}if(C==p.move.TYPE_INNER){if(!D[I]){D[I]=new Array()}if(D[I].length>0){B=D[I][D[I].length-1];B.isLastNode=false}D[I].splice(D[I].length,0,N);N.isLastNode=true;N.isFirstNode=(D[I].length==1)}else{if(D.isFirstNode&&C==p.move.TYPE_PREV){A[I].splice(T,0,N);B=D;B.isFirstNode=false;N.parentTId=D.parentTId;N.isFirstNode=true;N.isLastNode=false}else{if(D.isLastNode&&C==p.move.TYPE_NEXT){A[I].splice(T+1,0,N);B=D;B.isLastNode=false;N.parentTId=D.parentTId;N.isFirstNode=false;N.isLastNode=true}else{if(C==p.move.TYPE_PREV){A[I].splice(T,0,N)}else{A[I].splice(T+1,0,N)}N.parentTId=D.parentTId;N.isFirstNode=false;N.isLastNode=false}}}x.fixPIdKeyValue(K,N);x.setSonNodeLevel(K,N.getParentNode(),N);i.setNodeLineIcos(K,N);i.repairNodeLevelClass(K,N,V);if(!K.data.keep.parent&&S[I].length<1){S.isParent=false;S.open=false;var L=f("#"+S.tId+p.id.UL),O=f("#"+S.tId+p.id.SWITCH),J=f("#"+S.tId+p.id.ICON);i.replaceSwitchClass(S,O,p.folder.DOCU);i.replaceIcoClass(S,J,p.folder.DOCU);L.css("display","none")}else{if(X){i.setNodeLineIcos(K,X)}}if(B){i.setNodeLineIcos(K,B)}if(!!K.check&&K.check.enable&&i.repairChkClass){i.repairChkClass(K,S);i.repairParentChkClassWithSelf(K,S);if(S!=N.parent){i.repairParentChkClassWithSelf(K,N)}}if(!E){i.expandCollapseParentNode(K,N.getParentNode(),true,Y)}},removeEditBtn:function(A){f("#"+A.tId+p.id.EDIT).unbind().remove()},removeRemoveBtn:function(A){f("#"+A.tId+p.id.REMOVE).unbind().remove()},removeTreeDom:function(A,B){B.isHover=false;i.removeEditBtn(B);i.removeRemoveBtn(B);t.apply(A.view.removeHoverDom,[A.treeId,B])},repairNodeLevelClass:function(B,D,C){if(C===D.level){return}var E=f("#"+D.tId),H=f("#"+D.tId+p.id.A),G=f("#"+D.tId+p.id.UL),A="level"+C,F="level"+D.level;E.removeClass(A);E.addClass(F);H.removeClass(A);H.addClass(F);G.removeClass(A);G.addClass(F)}},r={tools:h,view:d,event:q,data:o};f.extend(true,f.fn.zTree.consts,z);f.extend(true,f.fn.zTree._z,r);var b=f.fn.zTree,t=b._z.tools,p=b.consts,i=b._z.view,x=b._z.data,q=b._z.event;x.exSetting(l);x.addInitBind(m);x.addInitCache(c);x.addInitNode(u);x.addInitProxy(n);x.addInitRoot(v);x.addZTreeTools(j);var s=i.cancelPreSelectedNode;i.cancelPreSelectedNode=function(C,D){var E=x.getRoot(C).curSelectedList;for(var B=0,A=E.length;B<A;B++){if(!D||D===E[B]){i.removeTreeDom(C,E[B]);if(D){break}}}if(s){s.apply(i,arguments)}};var w=i.createNodes;i.createNodes=function(C,D,B,A){if(w){w.apply(i,arguments)}if(!B){return}if(i.repairParentChkClassWithSelf){i.repairParentChkClassWithSelf(C,A)}};i.makeNodeUrl=function(A,B){return(B.url&&!A.edit.enable)?B.url:null};var a=i.removeNode;i.removeNode=function(B,C){var A=x.getRoot(B);if(A.curEditNode===C){A.curEditNode=null}if(a){a.apply(i,arguments)}};var y=i.selectNode;i.selectNode=function(C,D,B){var A=x.getRoot(C);if(x.isSelectedNode(C,D)&&A.curEditNode==D&&D.editNameFlag){return false}if(y){y.apply(i,arguments)}i.addHoverDom(C,D);return true};var e=t.uCanDo;t.uCanDo=function(B,C){var A=x.getRoot(B);if(C&&(t.eqs(C.type,"mouseover")||t.eqs(C.type,"mouseout")||t.eqs(C.type,"mousedown")||t.eqs(C.type,"mouseup"))){return true}return(!A.curEditNode)&&(e?e.apply(i,arguments):true)}})(jQuery);